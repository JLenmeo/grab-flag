# grab-flag
夺旗小游戏

## 游戏介绍

### 一、基础环境
一共20个兽人，随机出生在一个13X13的棋盘上。每个人拥有一个初始值“R值”，为1-100中的随机一个数（可以存在重复R值的兽人）。
“R值”代表了该兽人的最大生命值与攻击力。

### 二、胜利条件
在棋盘的正中央，有一面胜利之旗，夺得胜利之旗并成功离开棋盘的兽人将获得最终的胜利。
已知，旗子的R值为0.1，所有夺得旗子的兽人的R值都会被直接降至0.1，且无法丢弃旗子。

### 三、兽人行为
1. 移动：  
兽人共有8个移动方向，即自身周围的8个方格，每个回合会进行一次移动判定，以向量之和作为移动的方向（参考合力原则），移动的距离默认为1。
当两个向量方向相反相互抵消时，兽人不移动。

> - **普通移动**  
兽人以自己为中心，扩展开的一个11X11的区域，称之为移动感知区域，该兽人对此区域中R值大于自己的最大R值兽人形成一个反向向量，
对此区域中R值小于自己的最小R值兽人形成一个同向向量，以此来判断行动方向。如果移动感知区域内没有其他兽人，则该兽人朝随机方向移动2格。

> - **杀戮移动**  
兽人以自己为中心，扩展开的一个7X7的区域，称之为杀戮感知区域。当杀戮感知区域内存在R值比自己小的兽人（以最小的那个为优先杀戮目标），
且目标兽人周围5X5的区域内没有R值大于自己完成杀戮行动后的R值的兽人，则会进行杀戮移动，即直接朝着杀戮目标进行移动。如果在杀戮感知区域中存在R值比自己小的兽人，但目标兽人周围5X5的区域内存在R值大于自己完成杀戮行动后的R值得兽人，则将杀戮目标转移为另一个数字相对较小的兽人。
若杀戮移动最终无法完成判定，则按照普通移动进行移动。

> - **夺旗移动**  
当兽人的移动感知区域中出现旗子或已夺旗兽人时，则自动向该方向前进。

> - **逃脱移动**  
当兽人完成夺旗，自己身负旗子且R值降为0.1时，则进行逃脱移动判定。该兽人对离自己最近的兽人形成一个反向向量，
对离自己最近的棋盘边界形成一个同向向量，以此来判断行动方向。当最近的兽人以正向的形式出现在最近边界的方向上
时，同向向量改为次近的边界方向。  
当兽人处于中心位置时，已最近兽人的反向向量为逃脱方向。

2.杀戮：  
当兽人移动至杀戮目标周围1格时（即目标周围3X3区域内），即可进行杀戮判定。杀戮后自身R值为杀戮前R值减去杀戮目标R值，
若杀戮目标周围5X5的范围内没有R值高于自己杀戮后R值得兽人，即可完成杀戮。若有，则不执行杀戮，按照杀戮或普通移动判定判定移动方式。

3.恢复：  
当杀戮后的兽人当前R值少于自身初始R值时，每回合会恢复1点R值，直到回到自身初始的R值。

4.夺旗：  
当兽人移动至旗子或夺旗兽人周围1格时（即目标周围3X3区域内），即可进行夺旗判定。由于夺旗后自己会立刻变成最弱傻逼，兽人不会盲目夺旗。  
在进行夺旗判定时，若目标周围7X7区域内存在R值比自己大的兽人（取最大值），则自己立刻向该兽人的反方向移动1格。  
若目标周围7X7区域内有其他兽人，但R值都比自己小，则自己直接朝着范围内最大的兽人进行杀戮移动，并优先进行杀戮判定。  
若目标周围7X7区域内没有其他兽人，则直接完成夺旗。

## 代码介绍

### 一、技术栈
> - **整体框架SpringBoot**  
> - **模板Freemarker**  
> - **前端框架Layui**  

### 二、项目文件
> - **GameController.java**  
控制游戏进度，响应前端的请求。

> - **Checkerboard.java**  
用于记录棋盘当前的状态，保存着兽人与兽人之前的位置关系，以及对兽人行为进行判定。  
判定顺序：逃离判定->夺旗判定->夺旗移动判定->杀戮判定->杀戮移动判定->普通移动判定。

> - **Position.java**  
用于表示坐标(x,y)，以棋盘左上角作为原点(0,0)，向下为x正向，向右为y正向。

> - **Direction.java**  
用于表示方向，以(0,0)为中心，上为x方向；下为x反方向；右为y正方向；左为y反方向。用过x,y的正负来判断方向。  
> 方向坐标系<table>
  <tr><td>(-,-)</td><td>(-,0)</td><td>(-,+)</td></tr>
  <tr><td>(0,-)</td><td>(0,0)</td><td>(0,+)</td></tr>
  <tr><td>(+,-)</td><td>(+,0)</td><td>(+,+)</td></tr>
</table>
<table>
  <tr><td>左上</td><td>上</td><td>右上</td></tr>
  <tr><td>左</td><td>中心</td><td>右</td></tr>
  <tr><td>左下</td><td>下</td><td>右下</td></tr>
</table>
方向判断：
A(3,4)为源坐标 B(4,2)为目标坐标。
正向：B坐标值与A坐标相减得坐标正负号(+,-)，即左下。
反向：A坐标值与B坐标相减得坐标正负号(-,+)，即右上。

## 项目启动

普通的Springboot Web项目，以正常方式启动就行。启动后访问http://localhost:8080即可。

## 问题

本人非前端，页面的大小是根据自己的电脑分辨率来做的，没有做适应性，所以页面可能会乱七八糟，但是后台部分的功能是基本没问题的
